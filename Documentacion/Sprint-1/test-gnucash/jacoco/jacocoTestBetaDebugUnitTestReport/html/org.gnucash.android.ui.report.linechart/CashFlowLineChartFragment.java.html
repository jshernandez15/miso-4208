<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CashFlowLineChartFragment.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">app</a> &gt; <a href="index.source.html" class="el_package">org.gnucash.android.ui.report.linechart</a> &gt; <span class="el_source">CashFlowLineChartFragment.java</span></div><h1>CashFlowLineChartFragment.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2015 Oleksandr Tyshkovets &lt;olexandr.tyshkovets@gmail.com&gt;
 * Copyright (c) 2015 Ngewi Fet &lt;ngewif@gmail.com&gt;
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.gnucash.android.ui.report.linechart;

import android.graphics.Color;
import android.os.Bundle;
import android.util.Log;
import android.view.Menu;
import android.view.MenuItem;

import com.github.mikephil.charting.charts.LineChart;
import com.github.mikephil.charting.components.Legend;
import com.github.mikephil.charting.components.LimitLine;
import com.github.mikephil.charting.data.Entry;
import com.github.mikephil.charting.data.LineData;
import com.github.mikephil.charting.data.LineDataSet;
import com.github.mikephil.charting.highlight.Highlight;
import com.github.mikephil.charting.utils.LargeValueFormatter;

import org.gnucash.android.R;
import org.gnucash.android.db.adapter.AccountsDbAdapter;
import org.gnucash.android.db.adapter.TransactionsDbAdapter;
import org.gnucash.android.model.Account;
import org.gnucash.android.model.AccountType;
import org.gnucash.android.ui.report.BaseReportFragment;
import org.gnucash.android.ui.report.ReportType;
import org.gnucash.android.ui.report.ReportsActivity.GroupInterval;
import org.joda.time.LocalDate;
import org.joda.time.LocalDateTime;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collections;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;

import butterknife.BindView;

/**
 * Fragment for line chart reports
 *
 * @author Oleksandr Tyshkovets &lt;olexandr.tyshkovets@gmail.com&gt;
 * @author Ngewi Fet &lt;ngewif@gmail.com&gt;
 */
<span class="nc" id="L62">public class CashFlowLineChartFragment extends BaseReportFragment {</span>

    private static final String X_AXIS_PATTERN = &quot;MMM YY&quot;;
    private static final int ANIMATION_DURATION = 3000;
    private static final int NO_DATA_BAR_COUNTS = 5;
<span class="nc" id="L67">    private static final int[] COLORS = {</span>
<span class="nc" id="L68">            Color.parseColor(&quot;#68F1AF&quot;), Color.parseColor(&quot;#cc1f09&quot;), Color.parseColor(&quot;#EE8600&quot;),</span>
<span class="nc" id="L69">            Color.parseColor(&quot;#1469EB&quot;), Color.parseColor(&quot;#B304AD&quot;),</span>
    };
<span class="nc" id="L71">    private static final int[] FILL_COLORS = {</span>
<span class="nc" id="L72">            Color.parseColor(&quot;#008000&quot;), Color.parseColor(&quot;#FF0000&quot;), Color.parseColor(&quot;#BE6B00&quot;),</span>
<span class="nc" id="L73">            Color.parseColor(&quot;#0065FF&quot;), Color.parseColor(&quot;#8F038A&quot;),</span>
    };

<span class="nc" id="L76">    private AccountsDbAdapter mAccountsDbAdapter = AccountsDbAdapter.getInstance();</span>
<span class="nc" id="L77">    private Map&lt;AccountType, Long&gt; mEarliestTimestampsMap = new HashMap&lt;&gt;();</span>
<span class="nc" id="L78">    private Map&lt;AccountType, Long&gt; mLatestTimestampsMap = new HashMap&lt;&gt;();</span>
    private long mEarliestTransactionTimestamp;
    private long mLatestTransactionTimestamp;
<span class="nc" id="L81">    private boolean mChartDataPresent = true;</span>

    @BindView(R.id.line_chart) LineChart mChart;

    @Override
    public int getLayoutResource() {
<span class="nc" id="L87">        return R.layout.fragment_line_chart;</span>
    }

    @Override
    public int getTitle() {
<span class="nc" id="L92">        return R.string.title_cash_flow_report;</span>
    }

    @Override
    public void onActivityCreated(Bundle savedInstanceState) {
<span class="nc" id="L97">        super.onActivityCreated(savedInstanceState);</span>

<span class="nc" id="L99">        mChart.setOnChartValueSelectedListener(this);</span>
<span class="nc" id="L100">        mChart.setDescription(&quot;&quot;);</span>
<span class="nc" id="L101">        mChart.getXAxis().setDrawGridLines(false);</span>
<span class="nc" id="L102">        mChart.getAxisRight().setEnabled(false);</span>
<span class="nc" id="L103">        mChart.getAxisLeft().enableGridDashedLine(4.0f, 4.0f, 0);</span>
<span class="nc" id="L104">        mChart.getAxisLeft().setValueFormatter(new LargeValueFormatter(mCommodity.getSymbol()));</span>

<span class="nc" id="L106">        Legend legend = mChart.getLegend();</span>
<span class="nc" id="L107">        legend.setPosition(Legend.LegendPosition.BELOW_CHART_CENTER);</span>
<span class="nc" id="L108">        legend.setTextSize(16);</span>
<span class="nc" id="L109">        legend.setForm(Legend.LegendForm.CIRCLE);</span>

<span class="nc" id="L111">    }</span>

    @Override
    public ReportType getReportType() {
<span class="nc" id="L115">        return ReportType.LINE_CHART;</span>
    }

    /**
     * Returns a data object that represents a user data of the specified account types
     * @param accountTypeList account's types which will be displayed
     * @return a {@code LineData} instance that represents a user data
     */
    private LineData getData(List&lt;AccountType&gt; accountTypeList) {
<span class="nc" id="L124">        Log.w(TAG, &quot;getData&quot;);</span>
<span class="nc" id="L125">        calculateEarliestAndLatestTimestamps(accountTypeList);</span>
        // LocalDateTime?
        LocalDate startDate;
        LocalDate endDate;
<span class="nc bnc" id="L129" title="All 4 branches missed.">        if (mReportPeriodStart == -1 &amp;&amp; mReportPeriodEnd == -1) {</span>
<span class="nc" id="L130">            startDate = new LocalDate(mEarliestTransactionTimestamp).withDayOfMonth(1);</span>
<span class="nc" id="L131">            endDate = new LocalDate(mLatestTransactionTimestamp).withDayOfMonth(1);</span>
        } else {
<span class="nc" id="L133">            startDate = new LocalDate(mReportPeriodStart).withDayOfMonth(1);</span>
<span class="nc" id="L134">            endDate = new LocalDate(mReportPeriodEnd).withDayOfMonth(1);</span>
        }

<span class="nc" id="L137">        int count = getDateDiff(new LocalDateTime(startDate.toDate().getTime()), new LocalDateTime(endDate.toDate().getTime()));</span>
<span class="nc" id="L138">        Log.d(TAG, &quot;X-axis count&quot; + count);</span>
<span class="nc" id="L139">        List&lt;String&gt; xValues = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L140" title="All 2 branches missed.">        for (int i = 0; i &lt;= count; i++) {</span>
<span class="nc bnc" id="L141" title="All 4 branches missed.">            switch (mGroupInterval) {</span>
                case MONTH:
<span class="nc" id="L143">                    xValues.add(startDate.toString(X_AXIS_PATTERN));</span>
<span class="nc" id="L144">                    Log.d(TAG, &quot;X-axis &quot; + startDate.toString(&quot;MM yy&quot;));</span>
<span class="nc" id="L145">                    startDate = startDate.plusMonths(1);</span>
<span class="nc" id="L146">                    break;</span>
                case QUARTER:
<span class="nc" id="L148">                    int quarter = getQuarter(new LocalDateTime(startDate.toDate().getTime()));</span>
<span class="nc" id="L149">                    xValues.add(&quot;Q&quot; + quarter + startDate.toString(&quot; yy&quot;));</span>
<span class="nc" id="L150">                    Log.d(TAG, &quot;X-axis &quot; + &quot;Q&quot; + quarter + startDate.toString(&quot; MM yy&quot;));</span>
<span class="nc" id="L151">                    startDate = startDate.plusMonths(3);</span>
<span class="nc" id="L152">                    break;</span>
                case YEAR:
<span class="nc" id="L154">                    xValues.add(startDate.toString(&quot;yyyy&quot;));</span>
<span class="nc" id="L155">                    Log.d(TAG, &quot;X-axis &quot; + startDate.toString(&quot;yyyy&quot;));</span>
<span class="nc" id="L156">                    startDate = startDate.plusYears(1);</span>
                    break;
//                default:
            }
        }

<span class="nc" id="L162">        List&lt;LineDataSet&gt; dataSets = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L163" title="All 2 branches missed.">        for (AccountType accountType : accountTypeList) {</span>
<span class="nc" id="L164">            LineDataSet set = new LineDataSet(getEntryList(accountType), accountType.toString());</span>
<span class="nc" id="L165">            set.setDrawFilled(true);</span>
<span class="nc" id="L166">            set.setLineWidth(2);</span>
<span class="nc" id="L167">            set.setColor(COLORS[dataSets.size()]);</span>
<span class="nc" id="L168">            set.setFillColor(FILL_COLORS[dataSets.size()]);</span>

<span class="nc" id="L170">            dataSets.add(set);</span>
<span class="nc" id="L171">        }</span>

<span class="nc" id="L173">        LineData lineData = new LineData(xValues, dataSets);</span>
<span class="nc bnc" id="L174" title="All 2 branches missed.">        if (lineData.getYValueSum() == 0) {</span>
<span class="nc" id="L175">            mChartDataPresent = false;</span>
<span class="nc" id="L176">            return getEmptyData();</span>
        }
<span class="nc" id="L178">        return lineData;</span>
    }

    /**
     * Returns a data object that represents situation when no user data available
     * @return a {@code LineData} instance for situation when no user data available
     */
    private LineData getEmptyData() {
<span class="nc" id="L186">        List&lt;String&gt; xValues = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L187">        List&lt;Entry&gt; yValues = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L188" title="All 2 branches missed.">        for (int i = 0; i &lt; NO_DATA_BAR_COUNTS; i++) {</span>
<span class="nc" id="L189">            xValues.add(&quot;&quot;);</span>
<span class="nc bnc" id="L190" title="All 2 branches missed.">            yValues.add(new Entry(i % 2 == 0 ? 5f : 4.5f, i));</span>
        }
<span class="nc" id="L192">        LineDataSet set = new LineDataSet(yValues, getResources().getString(R.string.label_chart_no_data));</span>
<span class="nc" id="L193">        set.setDrawFilled(true);</span>
<span class="nc" id="L194">        set.setDrawValues(false);</span>
<span class="nc" id="L195">        set.setColor(NO_DATA_COLOR);</span>
<span class="nc" id="L196">        set.setFillColor(NO_DATA_COLOR);</span>

<span class="nc" id="L198">        return new LineData(xValues, Collections.singletonList(set));</span>
    }

    /**
     * Returns entries which represent a user data of the specified account type
     * @param accountType account's type which user data will be processed
     * @return entries which represent a user data
     */
    private List&lt;Entry&gt; getEntryList(AccountType accountType) {
<span class="nc" id="L207">        List&lt;String&gt; accountUIDList = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L208" title="All 2 branches missed.">        for (Account account : mAccountsDbAdapter.getSimpleAccountList()) {</span>
<span class="nc bnc" id="L209" title="All 2 branches missed.">            if (account.getAccountType() == accountType</span>
<span class="nc bnc" id="L210" title="All 2 branches missed.">                    &amp;&amp; !account.isPlaceholderAccount()</span>
<span class="nc bnc" id="L211" title="All 2 branches missed.">                    &amp;&amp; account.getCommodity().equals(mCommodity)) {</span>
<span class="nc" id="L212">                accountUIDList.add(account.getUID());</span>
            }
<span class="nc" id="L214">        }</span>

        LocalDateTime earliest;
        LocalDateTime latest;
<span class="nc bnc" id="L218" title="All 4 branches missed.">        if (mReportPeriodStart == -1 &amp;&amp; mReportPeriodEnd == -1) {</span>
<span class="nc" id="L219">            earliest = new LocalDateTime(mEarliestTimestampsMap.get(accountType));</span>
<span class="nc" id="L220">            latest = new LocalDateTime(mLatestTimestampsMap.get(accountType));</span>
        } else {
<span class="nc" id="L222">            earliest = new LocalDateTime(mReportPeriodStart);</span>
<span class="nc" id="L223">            latest = new LocalDateTime(mReportPeriodEnd);</span>
        }
<span class="nc" id="L225">        Log.d(TAG, &quot;Earliest &quot; + accountType + &quot; date &quot; + earliest.toString(&quot;dd MM yyyy&quot;));</span>
<span class="nc" id="L226">        Log.d(TAG, &quot;Latest &quot; + accountType + &quot; date &quot; + latest.toString(&quot;dd MM yyyy&quot;));</span>

<span class="nc" id="L228">        int xAxisOffset = getDateDiff(new LocalDateTime(mEarliestTransactionTimestamp), earliest);</span>
<span class="nc" id="L229">        int count = getDateDiff(earliest, latest);</span>
<span class="nc" id="L230">        List&lt;Entry&gt; values = new ArrayList&lt;&gt;(count + 1);</span>
<span class="nc bnc" id="L231" title="All 2 branches missed.">        for (int i = 0; i &lt;= count; i++) {</span>
<span class="nc" id="L232">            long start = 0;</span>
<span class="nc" id="L233">            long end = 0;</span>
<span class="nc bnc" id="L234" title="All 4 branches missed.">            switch (mGroupInterval) {</span>
                case QUARTER:
<span class="nc" id="L236">                    int quarter = getQuarter(earliest);</span>
<span class="nc" id="L237">                    start = earliest.withMonthOfYear(quarter * 3 - 2).dayOfMonth().withMinimumValue().millisOfDay().withMinimumValue().toDate().getTime();</span>
<span class="nc" id="L238">                    end = earliest.withMonthOfYear(quarter * 3).dayOfMonth().withMaximumValue().millisOfDay().withMaximumValue().toDate().getTime();</span>

<span class="nc" id="L240">                    earliest = earliest.plusMonths(3);</span>
<span class="nc" id="L241">                    break;</span>
                case MONTH:
<span class="nc" id="L243">                    start = earliest.dayOfMonth().withMinimumValue().millisOfDay().withMinimumValue().toDate().getTime();</span>
<span class="nc" id="L244">                    end = earliest.dayOfMonth().withMaximumValue().millisOfDay().withMaximumValue().toDate().getTime();</span>

<span class="nc" id="L246">                    earliest = earliest.plusMonths(1);</span>
<span class="nc" id="L247">                    break;</span>
                case YEAR:
<span class="nc" id="L249">                    start = earliest.dayOfYear().withMinimumValue().millisOfDay().withMinimumValue().toDate().getTime();</span>
<span class="nc" id="L250">                    end = earliest.dayOfYear().withMaximumValue().millisOfDay().withMaximumValue().toDate().getTime();</span>

<span class="nc" id="L252">                    earliest = earliest.plusYears(1);</span>
                    break;
            }
<span class="nc" id="L255">            float balance = (float) mAccountsDbAdapter.getAccountsBalance(accountUIDList, start, end).asDouble();</span>
<span class="nc" id="L256">            values.add(new Entry(balance, i + xAxisOffset));</span>
<span class="nc" id="L257">            Log.d(TAG, accountType + earliest.toString(&quot; MMM yyyy&quot;) + &quot;, balance = &quot; + balance);</span>

        }

<span class="nc" id="L261">        return values;</span>
    }

    /**
     * Calculates the earliest and latest transaction's timestamps of the specified account types
     * @param accountTypeList account's types which will be processed
     */
    private void calculateEarliestAndLatestTimestamps(List&lt;AccountType&gt; accountTypeList) {
<span class="nc bnc" id="L269" title="All 4 branches missed.">        if (mReportPeriodStart != -1 &amp;&amp; mReportPeriodEnd != -1) {</span>
<span class="nc" id="L270">            mEarliestTransactionTimestamp = mReportPeriodStart;</span>
<span class="nc" id="L271">            mLatestTransactionTimestamp = mReportPeriodEnd;</span>
<span class="nc" id="L272">            return;</span>
        }

<span class="nc" id="L275">        TransactionsDbAdapter dbAdapter = TransactionsDbAdapter.getInstance();</span>
<span class="nc bnc" id="L276" title="All 2 branches missed.">        for (Iterator&lt;AccountType&gt; iter = accountTypeList.iterator(); iter.hasNext();) {</span>
<span class="nc" id="L277">            AccountType type = iter.next();</span>
<span class="nc" id="L278">            long earliest = dbAdapter.getTimestampOfEarliestTransaction(type, mCommodity.getCurrencyCode());</span>
<span class="nc" id="L279">            long latest = dbAdapter.getTimestampOfLatestTransaction(type, mCommodity.getCurrencyCode());</span>
<span class="nc bnc" id="L280" title="All 4 branches missed.">            if (earliest &gt; 0 &amp;&amp; latest &gt; 0) {</span>
<span class="nc" id="L281">                mEarliestTimestampsMap.put(type, earliest);</span>
<span class="nc" id="L282">                mLatestTimestampsMap.put(type, latest);</span>
            } else {
<span class="nc" id="L284">                iter.remove();</span>
            }
<span class="nc" id="L286">        }</span>

<span class="nc bnc" id="L288" title="All 4 branches missed.">        if (mEarliestTimestampsMap.isEmpty() || mLatestTimestampsMap.isEmpty()) {</span>
<span class="nc" id="L289">            return;</span>
        }

<span class="nc" id="L292">        List&lt;Long&gt; timestamps = new ArrayList&lt;&gt;(mEarliestTimestampsMap.values());</span>
<span class="nc" id="L293">        timestamps.addAll(mLatestTimestampsMap.values());</span>
<span class="nc" id="L294">        Collections.sort(timestamps);</span>
<span class="nc" id="L295">        mEarliestTransactionTimestamp = timestamps.get(0);</span>
<span class="nc" id="L296">        mLatestTransactionTimestamp = timestamps.get(timestamps.size() - 1);</span>
<span class="nc" id="L297">    }</span>

    @Override
    public boolean requiresAccountTypeOptions() {
<span class="nc" id="L301">        return false;</span>
    }

    @Override
    protected void generateReport() {
<span class="nc" id="L306">        LineData lineData = getData(new ArrayList&lt;&gt;(Arrays.asList(AccountType.INCOME, AccountType.EXPENSE)));</span>
<span class="nc bnc" id="L307" title="All 2 branches missed.">        if (lineData != null) {</span>
<span class="nc" id="L308">            mChart.setData(lineData);</span>
<span class="nc" id="L309">            mChartDataPresent = true;</span>
        } else {
<span class="nc" id="L311">            mChartDataPresent = false;</span>
        }
<span class="nc" id="L313">    }</span>

    @Override
    protected void displayReport() {
<span class="nc bnc" id="L317" title="All 2 branches missed.">        if (!mChartDataPresent) {</span>
<span class="nc" id="L318">            mChart.getAxisLeft().setAxisMaxValue(10);</span>
<span class="nc" id="L319">            mChart.getAxisLeft().setDrawLabels(false);</span>
<span class="nc" id="L320">            mChart.getXAxis().setDrawLabels(false);</span>
<span class="nc" id="L321">            mChart.setTouchEnabled(false);</span>
<span class="nc" id="L322">            mSelectedValueTextView.setText(getResources().getString(R.string.label_chart_no_data));</span>
        } else {
<span class="nc" id="L324">            mChart.animateX(ANIMATION_DURATION);</span>
        }
<span class="nc" id="L326">        mChart.invalidate();</span>
<span class="nc" id="L327">    }</span>

    @Override
    public void onTimeRangeUpdated(long start, long end) {
<span class="nc bnc" id="L331" title="All 4 branches missed.">        if (mReportPeriodStart != start || mReportPeriodEnd != end) {</span>
<span class="nc" id="L332">            mReportPeriodStart = start;</span>
<span class="nc" id="L333">            mReportPeriodEnd = end;</span>
<span class="nc" id="L334">            mChart.setData(getData(new ArrayList&lt;&gt;(Arrays.asList(AccountType.INCOME, AccountType.EXPENSE))));</span>
<span class="nc" id="L335">            mChart.invalidate();</span>
        }
<span class="nc" id="L337">    }</span>

    @Override
    public void onGroupingUpdated(GroupInterval groupInterval) {
<span class="nc bnc" id="L341" title="All 2 branches missed.">        if (mGroupInterval != groupInterval) {</span>
<span class="nc" id="L342">            mGroupInterval = groupInterval;</span>
<span class="nc" id="L343">            mChart.setData(getData(new ArrayList&lt;&gt;(Arrays.asList(AccountType.INCOME, AccountType.EXPENSE))));</span>
<span class="nc" id="L344">            mChart.invalidate();</span>
        }
<span class="nc" id="L346">    }</span>

    @Override
    public void onPrepareOptionsMenu(Menu menu) {
<span class="nc" id="L350">        menu.findItem(R.id.menu_toggle_average_lines).setVisible(mChartDataPresent);</span>
        // hide pie/bar chart specific menu items
<span class="nc" id="L352">        menu.findItem(R.id.menu_order_by_size).setVisible(false);</span>
<span class="nc" id="L353">        menu.findItem(R.id.menu_toggle_labels).setVisible(false);</span>
<span class="nc" id="L354">        menu.findItem(R.id.menu_percentage_mode).setVisible(false);</span>
<span class="nc" id="L355">        menu.findItem(R.id.menu_group_other_slice).setVisible(false);</span>
<span class="nc" id="L356">    }</span>

    @Override
    public boolean onOptionsItemSelected(MenuItem item) {
<span class="nc bnc" id="L360" title="All 2 branches missed.">        if (item.isCheckable())</span>
<span class="nc bnc" id="L361" title="All 2 branches missed.">            item.setChecked(!item.isChecked());</span>
<span class="nc bnc" id="L362" title="All 3 branches missed.">        switch (item.getItemId()) {</span>
            case R.id.menu_toggle_legend:
<span class="nc bnc" id="L364" title="All 2 branches missed.">                mChart.getLegend().setEnabled(!mChart.getLegend().isEnabled());</span>
<span class="nc" id="L365">                mChart.invalidate();</span>
<span class="nc" id="L366">                return true;</span>

            case R.id.menu_toggle_average_lines:
<span class="nc bnc" id="L369" title="All 2 branches missed.">                if (mChart.getAxisLeft().getLimitLines().isEmpty()) {</span>
<span class="nc bnc" id="L370" title="All 2 branches missed.">                    for (LineDataSet set : mChart.getData().getDataSets()) {</span>
<span class="nc" id="L371">                        LimitLine line = new LimitLine(set.getYValueSum() / set.getEntryCount(), set.getLabel());</span>
<span class="nc" id="L372">                        line.enableDashedLine(10, 5, 0);</span>
<span class="nc" id="L373">                        line.setLineColor(set.getColor());</span>
<span class="nc" id="L374">                        mChart.getAxisLeft().addLimitLine(line);</span>
<span class="nc" id="L375">                    }</span>
                } else {
<span class="nc" id="L377">                    mChart.getAxisLeft().removeAllLimitLines();</span>
                }
<span class="nc" id="L379">                mChart.invalidate();</span>
<span class="nc" id="L380">                return true;</span>

            default:
<span class="nc" id="L383">                return super.onOptionsItemSelected(item);</span>
        }
    }

    @Override
    public void onValueSelected(Entry e, int dataSetIndex, Highlight h) {
<span class="nc bnc" id="L389" title="All 2 branches missed.">        if (e == null) return;</span>
<span class="nc" id="L390">        String label = mChart.getData().getXVals().get(e.getXIndex());</span>
<span class="nc" id="L391">        double value = e.getVal();</span>
<span class="nc" id="L392">        double sum = mChart.getData().getDataSetByIndex(dataSetIndex).getYValueSum();</span>
<span class="nc" id="L393">        mSelectedValueTextView.setText(String.format(SELECTED_VALUE_PATTERN, label, value, value / sum * 100));</span>
<span class="nc" id="L394">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.8.201612092310</span></div></body></html>